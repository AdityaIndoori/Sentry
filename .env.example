# =============================================================================
# Sentry — Self-Healing Server Monitor Configuration
# =============================================================================
# Copy this file:  cp .env.example .env
# Set ANTHROPIC_API_KEY (or Bedrock credentials) and SERVICE_HOST_PATH.
# Everything else has sensible defaults.
# =============================================================================

# ── LLM Provider ─────────────────────────────────────────────────────────────
# "anthropic" (direct API) or "bedrock_gateway" (AWS Bedrock Access Gateway)
LLM_PROVIDER=anthropic

# ── Anthropic API (used when LLM_PROVIDER=anthropic) ─────────────────────────
ANTHROPIC_API_KEY=sk-ant-your-key-here
ANTHROPIC_MODEL=claude-opus-4-0-20250514
ANTHROPIC_MAX_TOKENS=16384

# ── AWS Bedrock Access Gateway (used when LLM_PROVIDER=bedrock_gateway) ──────
# See: https://github.com/aws-samples/bedrock-access-gateway
BEDROCK_GATEWAY_API_KEY=your-gateway-api-key
BEDROCK_GATEWAY_BASE_URL=https://your-gateway.execute-api.us-east-1.amazonaws.com/api/v1
BEDROCK_GATEWAY_MODEL=anthropic.claude-opus-4-0-20250514
BEDROCK_GATEWAY_MAX_TOKENS=16384

# ── Security ─────────────────────────────────────────────────────────────────
# ACTIVE = full autonomous remediation (fix + restart)
# AUDIT  = read-only analysis — logs intent but never modifies (default, safe)
# DISABLED = all operations blocked
SENTRY_MODE=AUDIT
PROJECT_ROOT=/app/workspace
STOP_FILE_PATH=/app/STOP_SENTRY
MAX_COST_10MIN=5.00
MAX_RETRIES=3
RESTART_COOLDOWN=600

# ── Log Watcher ──────────────────────────────────────────────────────────────
# Comma-separated glob patterns for log files to monitor.
# /app/watched/  = the watched/ directory in this repo (always mounted)
# /app/workspace/ = your service source (mounted via SERVICE_HOST_PATH)
WATCH_PATHS=/app/watched/*.log,/app/workspace/logs/*.log
POLL_INTERVAL=5

# ── Service Awareness ────────────────────────────────────────────────────────
# SERVICE_HOST_PATH: absolute path on your HOST machine to the service source code.
#   Docker Compose mounts this into the container at /app/workspace.
#   Example: SERVICE_HOST_PATH=/home/user/my-flask-app
SERVICE_HOST_PATH=/path/to/your/service

# SERVICE_SOURCE_PATH: container-side path where agents read your code.
#   You should not need to change this.
SERVICE_SOURCE_PATH=/app/workspace

# SERVICE_RESTART_CMD: command Sentry runs to restart the monitored service
#   after applying a fix. Sentry is service-agnostic — you configure the exact command.
#   Examples:
#     SERVICE_RESTART_CMD=docker restart my-container
#     SERVICE_RESTART_CMD=systemctl restart my-service
#     SERVICE_RESTART_CMD=supervisorctl restart my-app
SERVICE_RESTART_CMD=docker restart my-container

# ── Memory ───────────────────────────────────────────────────────────────────
MEMORY_FILE_PATH=/app/data/sentry_memory.json
MAX_INCIDENTS_COMPACT=50

# ── Logging ──────────────────────────────────────────────────────────────────
# Directory for timestamped backend log files (one new file per startup).
# Leave empty to disable file logging (console only).
LOG_FILE_DIR=

# ── Server ───────────────────────────────────────────────────────────────────
API_HOST=0.0.0.0
API_PORT=8000
LOG_LEVEL=INFO
ENVIRONMENT=production
